```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Task 1 - Exploratory Data Analysis

### 1.1. Analysis

```{r}
# Load the dataset
customer_data <- read.csv("customer_purchases.csv")

# Convert necessary columns to factor type for categorical data
customer_data$region <- factor(customer_data$region)
customer_data$used_discount <- factor(customer_data$used_discount,
                                      levels = c(0,1),
                                      labels = c("No", "Yes"))

# Remove customer_id as it is an identifier not needed for analysis
customer_data$customer_id <- NULL

# Check the data structure and types
str(customer_data)

```

### (a) Summary Statics for Numerical Variables

```{r}
numeric_columns <- sapply(customer_data, is.numeric)
summary(customer_data[ , numeric_columns])

```

### (b) Visualizations

```{r}
# Histogram of purchase_amount with density overlay
hist(customer_data$purchase_amount,
     breaks = 30,
     probability = TRUE,
     main = "Histogram of Purchase Amount", 
     xlab = "Purchase Amount ($)")
lines(density(customer_data$purchase_amount), 
      col = "blue",
      lwd = 2)

```

```{r}
# Boxplot on time_spent_on_site by region
boxplot(time_spent_on_site ~ region, 
        data = customer_data,
        main = "Time Spent on Site by Region",
        xlab = "Region",
        ylab = "Time Spent (minutes)",
        col = "lightgray")

```

```{r}
# Sctterplot of purchase_amount vs time_spent_on_site
plot(customer_data$time_spent_on_site, 
     customer_data$purchase_amount,
     main = "Purchase Amount vs. Time Spent on Site",
     xlab = "Time Spent on Site (minutes)", 
     ylab = "Purchase Amount ($)",
     pch = 19, 
     col = "darkgray")

```

### (c) Missing Values Identification

```{r}
colSums(is.na(customer_data))

```

### (d) Outlier Detection

```{r}
numeric_variables <- c("purchase_amount", 
                       "time_spent_on_site", 
                       "number_of_previous_purchases")

for (variable in numeric_variables) {
  
  values <- customer_data[[variable]]
  
  Q1 <- quantile(values, 0.25)
  Q3 <- quantile(values, 0.75)
  interquartile_range <- Q3 - Q1
  
  lower_threshold <- Q1 - 1.5 * interquartile_range
  upper_threshold <- Q3 + 1.5 * interquartile_range
  
  outlier_indices <- which(values < lower_threshold | values > upper_threshold)
  
  cat(variable, ": ", length(outlier_indices), 
      " outliers (outside [", round(lower_threshold, 2), ",", round(upper_threshold, 2), "])\n")
}

```
### 1.2. Interpretation

### (a) Distribution of Key Variables

This dataset contains 2000 purchase records with three key numeric variables.
    - purchase_amount
    - time_spent_on_site
    - number_of_previous_purchases
The purchase_amount variable appears approximately symmetric, centered around USD 75. The histogram and density curve shows most purchases are between USD 60 and USD 90. Time spent on site ranges from about 1 to 20 minutes with a median around 10 minutes. And it is consistent across all regions based on the boxplot. The scatterplot between purchase_amount and time_spent_on_site shows there is no strong visible correlation. This shows purchase value is not directly linked to time spent on site. 

### (b) Data Quality

There were no missing values found in any column. Outlier analysis found a few higher values in all three numeric variables. Those higher ends of purchase_amount and number_of_previous_purchases may represent high spenders or regular customers while lower end of purchase_amount and time_spent_on_site may reflect quick, low value transactions. However, the number_of_previous_purchases shows only high end outliers, as negative values are not possible. Other than that overall dataset is clean and well structured.


## Task 2 - Probability Analysis

### 2.1. Calculations

### (a) Basic Probabilities

```{r}
# P(Purchase > 75)
P1 <- mean(customer_data$purchase_amount > 75)
cat("P(Purchase > 75) = ", P1)

# P(Used Discount | Purchase > 100)
high_spenders <- subset(customer_data, purchase_amount > 100)    
P2 <- mean(high_spenders$used_discount == "Yes")
cat("P(Used Discount | Purchase > 100) = ", P2)

```

### (b) Contingency Tables for Categorial Relationships

* Contingency table: Region vs Used Discount

```{r}
table_1 <- table(customer_data$region, customer_data$used_discount)
table_1

```


* Contingency table: Previous Purchases vs Used Discount

```{r}
table_2 <- table(customer_data$number_of_previous_purchases, customer_data$used_discount)
table_2

```

### (c) Conditional Probabilities by Region

```{r}
prop.table(table_1, margin = 1)

```

## 2.2. Interpretation

### (a) Customer Behaviour Insights from Probability Estimates

The probability that a customer's purchase amount exceeds USD 75 is approximately 49.1%. This shows that nearly half of the transactions are relatively high. Therefore, it shows a balanced customer base where both moderate and high spenders are included. The conditional probability of using a discount given that the purchase is over USD 100 is about 70.7%. This shows a strong behavioural pattern that customers are more likely to aply discounts when they spend big amount. This suggests that either the discounts encourage customers to spend more or hige value purchases makes customers look for discounts. This is a clear evidance that discounts are tightly linked to customer spending behaviours. 

### (b) Comparision of Probabilities Across Different Segments

The contingency table for region vs used_discount shows that customers from the East, North, and West regions have similar usage rates around 57%, while the South has camparatively a lower rate of approximately 51%. This shows that the customers in South are less likely to use discounts than the customers in other three regions. Even if it seems not that extreme, it still could be meaningful for region specific marketing strategies.

```{r}
table_3 <- as.data.frame.matrix(table_2)
table_3$total <- table_3$No + table_3$Yes
table_3$discount_used_percentage <- round((table_3$Yes / table_3$total) * 100, 1)
table_3 <- table_3[, c("No", "Yes", "total", "discount_used_percentage")]
table_3
```
When discount usage is analyzed across different levels of number_of_previous_purchases, there is no strong trend. After excluding groups with tiny sample sizes, the usage is relatively consistent across customer experience levels as the differences between groups seems minimal.

### (c) Marketing Recommondations Based on Probability Patterns

Based on the above findings, marketers can target several actions. 

First, since high value purchases are tightly associated with discount usage, they could offer percentage based discounts to encourage larger orders. 
    - Ex: Spend USD 100 and get 15% off
    
Second, South region customers who use discounts less often might benifit from direct promotions such as banner offers or limited time offers. 

Third, new customers could recive welcome discounts to boost first time conversion rates while repeat customers could recieve different incentives like free shipping, packages to increase and maintain long term engagement without always relying on discounts. 

### (d) Limitations of the Current Probability Analysis

The above probabilities do not imply any casual relationships. For an example, when high spenders use discounts more often, we cannot say whether the discount caused the high spend or vice versa. And the sample sizes across groups are unequal. Customers with 8 or 9 previous purchases represent a small subset. So their proportions may not be statistically stable. The analysis also does not include important factors like product type which could perplex the results. Since these are behavioural patterns, they may change over time and should be validated with further time series analysis. 


## Task 3 - Distribution Fitting

## 3.1. Analysis

### (a) 

* Poisson Distribution for number_of_previous_purchases

```{r}
estimated_lambda <- mean(customer_data$number_of_previous_purchases)
estimated_lambda

observed_counts <- table(customer_data$number_of_previous_purchases)
expected_counts <- dpois(as.numeric(names(observed_counts)), estimated_lambda) * length(customer_data$number_of_previous_purchases)
cbind(Observed = observed_counts, Expected = round(expected_counts, 1))

```

* Normal Distribution for Purchased Amount

```{r}
estimated_mu <- mean(customer_data$purchase_amount)
estimated_sigma <- sd(customer_data$purchase_amount)
estimated_mu; estimated_sigma

hist(customer_data$purchase_amount, 
     probability = TRUE, 
     breaks = 30,
     main = "Purchase Amounts with Fitted Normal Curve", 
     xlab = "Purchase Amount ($)")
curve(dnorm(x, mean = estimated_mu, sd = estimated_sigma), 
      col = "red", 
      lwd = 2, 
      add = TRUE)

```

## 3.2. Iterpretation

* Fitted Distribution

Customer behaviour is modelled by fitting a poisson distribution to the discrete variable number_of_previous_purchases. The estimated poisson parameter was approximately 2. This shows that on avarage, customers made just over 2 purchases. The observed frequency of purchase counts aligned well with the expected poisson values for lower counts like 0 - 4. Minor deviations can be seen for higher counts because the sample sizes are low. Overall this poisson distribution provides an acceptable fit for modeling repeat customer behaviour.

When fitting a normal distribution to the purchased_amount, a normal curve on the histogram of purchase amounts is overlayed using the estimated mean and standard deviation. This shows that the data follows an approximately bell shaped distribution. The normal curve aligns well with the central peak of the histogram. It confirms a relatively symmetric spending pattern. Those slight mismatches in the tails suggests extreme low or high purchase values that deviate from normality. 

```{r}
qqnorm(customer_data$purchase_amount, 
       main = "Q-Q Plot of Purchase Amounts",
       col = "darkblue", 
       pch = 19)
qqline(customer_data$purchase_amount, 
       col = "red", 
       lwd = 2)
```

The above Q-Q plot confirms the visual impression from the histogram. Most points align closely with the reference line. This shows that the purchase_amount variable is approximately normally distributed. Small deviations at the end shows mild outliers. Overall this normal distribution provides an acceptable fit. 


## Task 4 - Predictive Modeling

### (a) Scatterplot with Regression Line for purchase_amount vs time_spent_on_site

* The Type of Association Between time_spent(X-axis) and purchase_amount (Y-axis)

The scatterplot shows a weak positive association between time spent on site and purchase amount. There are some indications that customers who spend more time may make slightly higher purchases but that relationship is not strong. The points are fairly spread out. That suggesting that other factors may also influence spending behaviour.

```{r}
plot(customer_data$time_spent_on_site, 
     customer_data$purchase_amount,
     main = "Purchase Amount vs Time Spent on Site",
     xlab = "Time Spent on Site (minutes)", ylab = "Purchase Amount ($)",
     pch = 19, col = "darkblue")
linear_regression_model <- lm(purchase_amount ~ time_spent_on_site, 
                              data = customer_data)
abline(linear_regression_model, col = "red", lwd = 2)

```

### (b)

```{r}
correlation_value <- cor(customer_data$time_spent_on_site, customer_data$purchase_amount)
cat("Correlation between time_spent_on_site and purchase_amount:", round(correlation_value, 3))

summary(linear_regression_model)

```

### (c) 

```{r}
beta0 <- coef(linear_regression_model)[1]
beta1 <- coef(linear_regression_model)[2]

cat("Fitted equation:\n purchase_amount = ", round(beta0, 2), " + ", round(beta1, 2), " * time_spent_on_site")

```

### (d) Predicted purchase_amount for a time_spent_on_site of 12 minutes

```{r}
prediction <- predict(linear_regression_model, newdata = data.frame(time_spent_on_site = 12))
cat("Predicted purchase_amount for 12 minutes on site: $", round(prediction, 2))

```